-- Create blog_posts table
CREATE TABLE public.blog_posts (
  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,
  title TEXT NOT NULL,
  slug TEXT NOT NULL UNIQUE,
  content TEXT NOT NULL,
  excerpt TEXT,
  category TEXT,
  author_id UUID REFERENCES auth.users(id),
  status TEXT DEFAULT 'published',
  published_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Enable RLS
ALTER TABLE public.blog_posts ENABLE ROW LEVEL SECURITY;

-- Create policies
CREATE POLICY "Everyone can view published posts"
ON public.blog_posts
FOR SELECT
USING (status = 'published');

CREATE POLICY "Admins can manage posts"
ON public.blog_posts
FOR ALL
USING (has_role(auth.uid(), 'admin'));

-- Create trigger for updated_at
CREATE TRIGGER update_blog_posts_updated_at
BEFORE UPDATE ON public.blog_posts
FOR EACH ROW
EXECUTE FUNCTION public.update_updated_at_column();

-- Insert some initial forum posts about military service
INSERT INTO public.forum_posts (title, content, topic_type, status, user_id) VALUES
(
  'Юридические аспекты отсрочки от призыва по состоянию здоровья',
  'Согласно статье 23 Федерального закона "О воинской обязанности и военной службе", граждане, признанные не годными или ограниченно годными к военной службе по состоянию здоровья, освобождаются от призыва или получают отсрочку. Важно знать свои права и правильно оформить медицинские документы.',
  'legal',
  'approved',
  NULL
),
(
  'Медицинское освидетельствование при призыве: что нужно знать',
  'Медицинское освидетельствование проводится врачебной комиссией военкомата. Призывник имеет право на независимую медицинскую экспертизу и может обжаловать решение комиссии. Расскажу о процедуре и необходимых документах.',
  'health',
  'approved',
  NULL
),
(
  'Постановка на воинский учёт: пошаговая инструкция',
  'Все граждане мужского пола обязаны встать на воинский учёт в год достижения 17 лет. В этой теме разберём порядок постановки на учёт, необходимые документы и возможные трудности.',
  'legal',
  'approved',
  NULL
),
(
  'Категории годности к военной службе: А, Б, В, Г, Д',
  'Категория "А" - годен к военной службе, "Б" - годен с незначительными ограничениями, "В" - ограниченно годен, "Г" - временно не годен, "Д" - не годен. Подробно о каждой категории и заболеваниях.',
  'health',
  'approved',
  NULL
),
(
  'Права призывника при прохождении медкомиссии',
  'Призывник имеет право на полное медицинское обследование, получение копий медицинских документов, присутствие представителя или адвоката. Важно знать свои права и не бояться их отстаивать.',
  'general',
  'approved',
  NULL
);

-- Insert initial blog posts
INSERT INTO public.blog_posts (title, slug, content, excerpt, category, status, published_at) VALUES
(
  'Изменения в законодательстве о призыве в 2024 году',
  'izmeneniya-v-zakonodatelstve-2024',
  'В 2024 году вступили в силу важные изменения в Федеральном законе "О воинской обязанности и военной службе". Основные нововведения касаются электронной повестки, расширения перечня оснований для отсрочки и ужесточения ответственности за уклонение от призыва.

Электронная повестка теперь имеет юридическую силу и считается врученной с момента размещения в личном кабинете на портале Госуслуг. Призывник обязан явиться в военкомат в течение 20 дней с момента получения электронной повестки.

Расширен перечень оснований для получения отсрочки от призыва. Теперь отсрочку могут получить граждане, осуществляющие уход за близкими родственниками при определённых условиях.

Ужесточена ответственность за неявку по повестке - теперь это может повлечь административный штраф до 30 000 рублей и ограничение права на выезд за границу.',
  'Обзор ключевых изменений в законодательстве о воинской обязанности, вступивших в силу в 2024 году',
  'Законодательство',
  'published',
  NOW() - INTERVAL '5 days'
),
(
  'Как правильно подготовиться к медкомиссии в военкомате',
  'kak-podgotovitsya-k-medkomissii',
  'Медицинское освидетельствование в военкомате - важный этап призыва, от результатов которого зависит категория годности к военной службе. Правильная подготовка поможет объективно оценить состояние здоровья.

Перед прохождением комиссии рекомендуется:
1. Собрать все медицинские документы, справки, результаты обследований
2. Пройти обследование у профильных специалистов при наличии хронических заболеваний
3. Получить выписки из медицинской карты
4. Подготовить копии всех документов

Во время комиссии призывник имеет право на полное обследование, дополнительные консультации специалистов и независимую экспертизу. Важно не скрывать информацию о заболеваниях и настаивать на тщательном обследовании.

Если вы не согласны с решением комиссии, его можно обжаловать в вышестоящей призывной комиссии или через суд.',
  'Практические советы по подготовке к медицинскому освидетельствованию и защите своих прав',
  'Медицина',
  'published',
  NOW() - INTERVAL '10 days'
),
(
  'Юридическая помощь призывникам: когда она необходима',
  'yuridicheskaya-pomoshch-prizyvnikam',
  'Квалифицированная юридическая помощь может быть необходима призывникам в различных ситуациях:

1. Обжалование решения призывной комиссии
2. Оформление отсрочки или освобождения от призыва
3. Защита прав при медицинском освидетельствовании
4. Представление интересов в военкомате
5. Обжалование действий должностных лиц

Юрист может помочь правильно собрать документы, составить заявления и жалобы, представлять интересы в комиссиях и судах. Особенно важна юридическая помощь при наличии оснований для освобождения от призыва по состоянию здоровья.

Мы предоставляем полный спектр юридических услуг для призывников: консультации, сопровождение в военкомате, обжалование решений, представительство в суде.',
  'Когда призывнику необходима профессиональная юридическая помощь и как её получить',
  'Юридическая помощь',
  'published',
  NOW() - INTERVAL '15 days'
);